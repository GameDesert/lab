airline_codes = {
    "A3":"Aegean Airlines",
    "AC":"Air Canada",
    "CA":"Air China",
    "AI":"Air India",
    "NZ":"Air New Zealand",
    "NH":"All Nippon Airways",
    "OZ":"Asiana Airlines",
    "OS":"Austrian Airlines",
    "AV":"Avianca",
    "SN":"Brussels Airlines",
    "CM":"Copa Airlines",
    "OU":"Croatia Airlines",
    "MS":"Egyptair",
    "ET":"Ethiopian Airlines",
    "BR":"EVA Air",
    "LO":"LOT Polish Airlines",
    "LH":"Lufthansa",
    "SK":"Scandinavian Airlines",
    "ZH":"Shenzhen Airlines",
    "SQ":"Singapore Airlines",
    "SA":"South African Airways",
    "LX":"SWISS",
    "TP":"TAP Air Portugal",
    "TG":"THAI",
    "TK":"Turkish Airlines",
    "UA":"United Airlines",
    "AS":"Alaska Airlines",
    "AA":"American Airlines",
    "BA":"British Airways",
    "CX":"Cathay Pacific",
    "AY":"Finnair",
    "IB":"Iberia",
    "JL":"Japan Airlines",
    "MH":"Malaysia Airlines",
    "QF":"Qantas",
    "QR":"Qatar Airways",
    "AT":"Royal Air Maroc",
    "RJ":"Royal Jordanian",
    "UL":"SriLankan Airlines",
    "U2":"EasyJet UK",
    "EC":"EasyJet Europe",
    "DS":"EasyJet Switzerland",
    "W6":"Wizz Air",
    "5W":"Wizz Air Abu Dhabi",
    "W9":"Wizz Air UK",
    "W4":"Wizz Air Malta",
    "BY":"TUI Airways",
    "LS":"Jet2.com",
    "FR":"Ryanair",
    "RR":"Buzz",
    "RK":"Ryanair UK",
    "AL":"Malta Air",
    "LW":"Lauda Europe",
    "KM":"Air Malta",
    "KL":"KLM",
    "SU":"Aeroflot",
    "KE":"Korean Air",
    "EY":"Etihad Airways",
    "EK":"Emirates",
    "LY":"El Al",
    "EI":"Aer Lingus",
    "FI":"Icelandair",
    "AF":"Air France",
    "AM":"AeromÃ©xico",
    "EW":"Eurowings",
    "WN":"Southwest Airlines",
    "NK":"Spirit Airlines",
    "DL":"Delta Air Lines",
    "F9":"Frontier Airlines",
    "B6":"JetBlue",
    "BE":"Flybe",
    "VS":"Virgin Atlantic"
}

airline_colours = {
    "A3":"#041c79",
    "AC":"#f00d23",
    "CA":"#ed1c24",
    "AI":"#d90205",
    "NZ":"#1d1819",
    "NH":"#1e3d9a",
    "OZ":"#e6020b",
    "OS":"#d71b14",
    "AV":"#ed0302",
    "SN":"#e50326",
    "CM":"#0660a9",
    "OU":"#ed1a22",
    "MS":"#02215b",
    "ET":"#c62124",
    "BR":"#00a64f",
    "LO":"#142d70",
    "LH":"#031639",
    "SK":"#272c87",
    "ZH":"#cd0121",
    "SQ":"#fbb131",
    "SA":"#103383",
    "LX":"#e60202",
    "TP":"#bfd733",
    "TG":"#340761",
    "TK":"#c80404",
    "UA":"#0630a0",
    "AS":"#02355e",
    "AA":"#069ad2",
    "BA":"#2f5e9a",
    "CX":"#006b6e",
    "AY":"#0b1560",
    "IB":"#dc1629",
    "JL":"#e60209",
    "MH":"#02265a",
    "QF":"#d50201",
    "QR":"#5b022d",
    "AT":"#c70730",
    "RJ":"#a7844a",
    "UL":"#0a197c",
    "U2":"#ff6600",
    "EC":"#ff6600",
    "DS":"#ff6600",
    "W6":"#d50d8c",
    "5W":"#d50d8c",
    "W9":"#d50d8c",
    "W4":"#d50d8c",
    "BY":"#d4070c",
    "LS":"#e21e13",
    "FR":"#274579",
    "RR":"#fbd017",
    "RK":"#274579",
    "AL":"#c90507",
    "LW":"#e6123f",
    "KM":"#ad0404",
    "KL":"#08a2e3",
    "SU":"#044893",
    "KE":"#184d9d",
    "EY":"#bd8b13",
    "EK":"#d7131b",
    "LY":"#010a43",
    "EI":"#026372",
    "FI":"#031570",
    "AF":"#ff0302",
    "AM":"#052b57",
    "EW":"#8f174f",
    "WN":"#2e4bb2",
    "NK":"#1d1819",
    "DL":"#033a78",
    "F9":"#046642",
    "B6":"#033575",
    "BE":"#5a3d99",
    "VS":"#eb0e36"
}

airline_text_colours = {
    "A3":"#fff",
    "AC":"#fff",
    "CA":"#fff",
    "AI":"#fff",
    "NZ":"#fff",
    "NH":"#fff",
    "OZ":"#fff",
    "OS":"#fff",
    "AV":"#fff",
    "SN":"#fff",
    "CM":"#fff",
    "OU":"#fff",
    "MS":"#fff",
    "ET":"#fff",
    "BR":"#fff",
    "LO":"#fff",
    "LH":"#fff",
    "SK":"#fff",
    "ZH":"#fff",
    "SQ":"#000",
    "SA":"#fff",
    "LX":"#fff",
    "TP":"#000",
    "TG":"#fff",
    "TK":"#fff",
    "UA":"#fff",
    "AS":"#fff",
    "AA":"#000",
    "BA":"#fff",
    "CX":"#fff",
    "AY":"#fff",
    "IB":"#fff",
    "JL":"#fff",
    "MH":"#fff",
    "QF":"#fff",
    "QR":"#fff",
    "AT":"#fff",
    "RJ":"#000",
    "UL":"#fff",
    "U2":"#000",
    "EC":"#000",
    "DS":"#000",
    "W6":"#000",
    "5W":"#000",
    "W9":"#000",
    "W4":"#000",
    "BY":"#fff",
    "LS":"#fff",
    "FR":"#fff",
    "RR":"#000",
    "RK":"#fff",
    "AL":"#fff",
    "LW":"#fff",
    "KM":"#fff",
    "KL":"#000",
    "SU":"#fff",
    "KE":"#fff",
    "EY":"#000",
    "EK":"#fff",
    "LY":"#fff",
    "EI":"#fff",
    "FI":"#fff",
    "AF":"#fff",
    "AM":"#fff",
    "EW":"#fff",
    "WN":"#fff",
    "NK":"#fff",
    "DL":"#fff",
    "F9":"#fff",
    "B6":"#fff",
    "BE":"#fff",
    "VS":"#fff"
}

function decodeBCBP(barcode_data) {
    luggage_license_plate = ""
    
    passenger_name = barcode_data.substring(2,22).trim()
    pnr = barcode_data.substring(23,30).trim()
    origin_airport = barcode_data.substring(30,33).trim()
    destination_airport = barcode_data.substring(33,36).trim()
    carrier = barcode_data.substring(36,39).trim()
    flight = barcode_data.substring(39,44).trim()
    date = barcode_data.substring(44,47).trim()
    class_code = barcode_data.substring(47,48).trim()
    seat = barcode_data.substring(48,52).trim()
    sequence = barcode_data.substring(52,57).trim()
    
// Optional Data (Enclose in IF statement when done)
    if (barcode_data.length > 60) {
        issue_date = barcode_data.substring(67,71).trim()
        luggage_license_plate = barcode_data.substring(75,88).trim()

        frequent_flier = barcode_data.substring(111,127).trim()
        baggage_allowance = barcode_data.substring(128,131).trim()

        console.log(issue_date)
        // document.getElementById("sequence_text_value").innerHTML = sequence

        console.log(frequent_flier)
        // document.getElementById("sequence_text_value").innerHTML = sequence

        console.log(luggage_license_plate)
        document.getElementById("license_text_tag_value").innerHTML = luggage_license_plate
    
        console.log(baggage_allowance)
        document.getElementById("weight_text_tag_value").innerHTML = baggage_allowance
    
    }

    console.log(passenger_name)
    if ((passenger_name.length < 13)) {
        document.getElementById("name_text_svg").style.fontSize = "7.46204px"
    } else if ((passenger_name.length >= 13) && (passenger_name.length < 16)) {
        document.getElementById("name_text_svg").style.fontSize = "6.46204px"
    } else if ((passenger_name.length >= 16) && (passenger_name.length < 19)) {
        document.getElementById("name_text_svg").style.fontSize = "5.46204px"
    } else if ((passenger_name.length >= 19) && (passenger_name.length <= 20)) {
        document.getElementById("name_text_svg").style.fontSize = "4.46204px"
    }
    document.getElementById("name_text_value").innerHTML = passenger_name
    document.getElementById("name_text_tag_value").innerHTML = passenger_name

    console.log(pnr)
    document.getElementById("pnr_text_value").innerHTML = pnr
    document.getElementById("pnr_text_tag_value").innerHTML = pnr

    console.log(origin_airport)
    document.getElementById("origin_airport_text_value").innerHTML = origin_airport
    document.getElementById("origin_text_tag_value").innerHTML = origin_airport

    console.log(destination_airport)
    document.getElementById("destination_airport_text_value").innerHTML = destination_airport
    document.getElementById("destination_text_tag_value").innerHTML = destination_airport

    console.log(carrier)
    document.getElementById("carrier_text_tag_value").innerHTML = carrier
    if (carrier.toUpperCase() in airline_codes){
        document.getElementById("airline_text_value").innerHTML = airline_codes[carrier]
        document.getElementById("stub_bg_svg").style.fill = airline_colours[carrier]
        document.getElementById("airline_text_value").style.fill = airline_text_colours[carrier]

        if ((airline_codes[carrier].length < 9)) {
            document.getElementById("airline_text_svg").style.fontSize = "13.0539px"
        } else if ((airline_codes[carrier].length >= 9) && (airline_codes[carrier].length < 14)) {
            document.getElementById("airline_text_svg").style.fontSize = "9.0539px"
        } else if ((airline_codes[carrier].length >= 14) && (airline_codes[carrier].length < 19)) {
            document.getElementById("airline_text_svg").style.fontSize = "8.0539px"
        } else if ((airline_codes[carrier].length >= 19)) {
            document.getElementById("airline_text_svg").style.fontSize = "6.0539px"
        }
    } else {
        document.getElementById("airline_text_value").innerHTML = carrier
    }

    console.log(flight)
    document.getElementById("flight_text_value").innerHTML = carrier + " " + flight
    document.getElementById("flight_text_tag_value").innerHTML = carrier + flight

    console.log(date)

    var bp_year = new Date();
    var bp_init_date = new Date(bp_year.getFullYear(), 0); // initialize a date in `year-01-01`
    var bp_set_date = new Date(bp_init_date.setDate(date)); // add the number of days
    var bp_full_date = bp_set_date.toLocaleDateString("en-GB", {month: 'short', day: 'numeric' })

    document.getElementById("date_text_value").innerHTML = bp_full_date

    var tag_year = new Date();
    var tag_init_date = new Date(tag_year.getFullYear(), 0); // initialize a date in `year-01-01`
    var tag_set_date = new Date(tag_init_date.setDate(date)); // add the number of days
    var tag_full_date = tag_set_date.toLocaleDateString("en-GB", {month: 'short', day: 'numeric', year: 'numeric' })

    document.getElementById("date_text_tag_value").innerHTML = tag_full_date

    console.log(class_code)
    document.getElementById("class_text_value").innerHTML = class_code

    console.log(seat)
    document.getElementById("seat_text_value").innerHTML = seat

    console.log(sequence)
    document.getElementById("sequence_text_value").innerHTML = sequence
    document.getElementById("sequence_text_tag_value").innerHTML = sequence

    document.getElementById("boardingpass").style.display = "block";
    setTimeout(function(){
        document.getElementById("boardingpasssvg").style.opacity = 1;
    },1);

    if (luggage_license_plate != "") {
        document.getElementById("luggagetag").style.display = "block";
        setTimeout(function(){
            document.getElementById("luggagetagsvg").style.opacity = 1;
        },1);
    }
}

function submitBCBP(data) {
    decodeBCBP(data)
}


// Upload image to get data.
// check compatibility
if (!("BarcodeDetector" in window)) {
    console.log("Barcode Detector is not supported by this browser.");
  } else {
    console.log("Barcode Detector supported!");
  
    // create new detector to detect only 2D codes (rather than barcodes)
    const barcodeDetector = new BarcodeDetector({
      formats: [
        'aztec',
        'data_matrix',
        'pdf417',
        'qr_code'
      ],
    });
  }
  

// TODO:
// - Finish boarding pass graphic using samples from resolution 792 document
// - Finish parsing of BCBP (decodeBCBP())
// - Display boarding pass with BCBP info
// - Change ticket stub colour based on airline
// - Finish list of known airline codes
// - Create graphic representation of luggage tag where applicable __DONE__ 